<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Évaluation de Véhicule</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            color: #1a1a1a;
            padding: env(safe-area-inset-top, 0) env(safe-area-inset-right, 0) env(safe-area-inset-bottom, 0) env(safe-area-inset-left, 0);
        }

        .widget {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
            width: clamp(560px, 80vw, 760px);
            max-height: 90svh;
            max-height: 90dvh; /* fallback */
            max-height: 90vh; /* fallback */
            overflow-y: auto;
            padding: clamp(16px, 2vw, 24px);
            position: relative;
        }

        @media (max-width: 768px) {
            body {
                padding: 0;
                align-items: stretch;
            }
            
            .widget {
                width: 100%;
                max-height: 100svh;
                max-height: 100dvh; /* fallback */
                max-height: 100vh; /* fallback */
                border-radius: 0;
                padding: clamp(12px, 4vw, 16px);
                box-shadow: none;
            }
        }

        /* Progress Bar */
        .progress-container {
            margin-bottom: 32px;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #13d0ca;
            transition: width 0.3s ease;
            border-radius: 2px;
        }

        .progress-text {
            margin-top: 8px;
            font-size: 14px;
            color: #6c757d;
            text-align: center;
        }

        /* Logo */
        .logo {
            text-align: center;
            margin-bottom: 32px;
        }

        .logo img {
            max-width: 200px;
            height: auto;
        }

        /* Steps */
        .step {
            display: none;
        }

        .step.active {
            display: block;
        }

        .step-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            text-align: center;
        }

        .step-subtitle {
            color: #6c757d;
            margin-bottom: 32px;
            text-align: center;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 24px;
        }

        @media (max-width: 768px) {
            .form-group {
                margin-bottom: 8px;
            }
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #1a1a1a;
        }

        .form-input {
            width: 100%;
            padding: 16px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.2s ease;
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: #13d0ca;
        }

        .form-select {
            width: 100%;
            padding: 16px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 16px;
            background: white;
            cursor: pointer;
            transition: border-color 0.2s ease;
        }

        .form-select:focus {
            outline: none;
            border-color: #13d0ca;
        }

        /* Two Column Layout */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        @media (max-width: 540px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* Vehicle Summary */
        .vehicle-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin: 24px 0;
        }

        .vehicle-summary h3 {
            margin-bottom: 12px;
            font-size: 18px;
        }

        .vehicle-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .vehicle-detail:last-child {
            margin-bottom: 0;
            font-weight: 600;
            padding-top: 12px;
            border-top: 1px solid #dee2e6;
        }

        /* Options - NOUVELLES RÈGLES COMPACTES */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 8px;
            margin: 16px 0;
        }

        .option-card {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 8px 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .option-card:hover {
            border-color: #13d0ca;
        }

        .option-card.selected {
            border-color: #13d0ca;
            background: #f0fffe;
        }

        .option-title {
            font-weight: 600;
            font-size: 13px;
        }

        .option-price {
            color: #13d0ca;
            font-weight: 600;
        }

        /* Button */
        .btn {
            width: 100%;
            padding: 16px 24px;
            background: #13d0ca;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease;
            margin-top: 24px;
        }

        .btn:hover {
            background: #10b3ae;
        }

        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .btn-back {
            background: #e9ecef;
            color: #1a1a1a;
            margin-right: 12px;
            width: auto;
            flex: 1;
        }

        .btn-back:hover {
            background: #dee2e6;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        /* Estimate Display */
        .estimate-amount {
            font-size: 48px;
            font-weight: 700;
            color: #13d0ca;
            text-align: center;
            margin: 32px 0;
        }

        .calculation-breakdown {
            background: #f8f9fa;
            padding: 24px;
            border-radius: 12px;
            margin: 24px 0;
        }

        .calculation-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #dee2e6;
        }

        .calculation-item:last-child {
            border-bottom: none;
            font-weight: 600;
            font-size: 18px;
        }

        .next-steps {
            background: #f0fffe;
            border: 1px solid #13d0ca;
            border-radius: 8px;
            padding: 16px;
            margin: 24px 0;
        }

        .next-steps h3 {
            color: #0fa9a4;
            margin-bottom: 16px;
        }

        .next-steps ul {
            list-style: none;
            padding: 0;
        }

        .next-steps li {
            margin-bottom: 8px;
            padding-left: 24px;
            position: relative;
        }

        .next-steps li::before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #13d0ca;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="widget">
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">Étape 1 sur 4</div>
        </div>

        <!-- Step 1: Vehicle Information -->
        <div class="step active" id="step1">
            <div class="logo">
                <img src="https://usine-a-sites.s3.eu-west-1.amazonaws.com/site-peugeot-test/Spoticar-Logo-Vector.svg-.png" alt="Spoticar" />
            </div>
            
            <h2 class="step-title">Informations sur votre véhicule</h2>
            <p class="step-subtitle">Renseignez les détails de base de votre véhicule</p>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label" for="registration">Numéro d'immatriculation</label>
                    <input type="text" id="registration" class="form-input" placeholder="AB-123-CD" />
                </div>
                <div class="form-group">
                    <label class="form-label" for="mileage">Kilométrage</label>
                    <input type="number" id="mileage" class="form-input" placeholder="150000" />
                </div>
            </div>

            <div style="background: #f0fffe; border: 1px solid #13d0ca; border-radius: 8px; padding: 16px; margin: 24px 0; display: flex; align-items: center; gap: 12px;">
                <div style="color: #13d0ca; font-size: 20px; font-weight: bold;">✓</div>
                <div>
                    <div style="font-weight: 600; color: #1a1a1a; margin-bottom: 4px;">Évaluation gratuite et sans engagement</div>
                    <div style="font-size: 14px; color: #6c757d;">Obtenez une estimation précise en 2 minutes. Aucune obligation d'achat.</div>
                </div>
            </div>

            <button class="btn" onclick="nextStep(2)">Continuer</button>
        </div>

        <!-- Step 2: Vehicle Trim Selection -->
        <div class="step" id="step2">
            <h2 class="step-title">Choisissez votre finition</h2>
            <p class="step-subtitle">Sélectionnez la finition qui correspond à votre véhicule</p>

            <div class="vehicle-summary" id="vehicleSummary">
                <h3 style="display: flex; align-items: center; gap: 8px;">
                    <span style="color: #13d0ca; font-size: 18px;">✓</span>
                    Véhicule trouvé
                </h3>
                <div class="vehicle-detail">
                    <span>Marque :</span>
                    <span id="vehicleBrand">Peugeot</span>
                </div>
                <div class="vehicle-detail">
                    <span>Modèle :</span>
                    <span id="vehicleModel">308</span>
                </div>
                <div class="vehicle-detail">
                    <span>Énergie :</span>
                    <span id="vehicleEnergy">Hybride</span>
                </div>
                <div class="vehicle-detail">
                    <span>Année :</span>
                    <span id="vehicleYear">2022</span>
                </div>
                <div class="vehicle-detail">
                    <span>Kilométrage :</span>
                    <span id="vehicleMileage">150 000 km</span>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Finitions disponibles</label>
                <div class="options-grid">
                    <div class="option-card trim-option" data-trim="style" onclick="selectTrim(this, 'style')">
                        <div class="option-title">Style</div>
                    </div>
                    <div class="option-card trim-option" data-trim="allure" onclick="selectTrim(this, 'allure')">
                        <div class="option-title">Allure</div>
                    </div>
                    <div class="option-card trim-option" data-trim="allure-pack" onclick="selectTrim(this, 'allure-pack')">
                        <div class="option-title">Allure Pack</div>
                    </div>
                    <div class="option-card trim-option" data-trim="gt" onclick="selectTrim(this, 'gt')">
                        <div class="option-title">GT</div>
                    </div>
                    <div class="option-card trim-option" data-trim="gt-pack" onclick="selectTrim(this, 'gt-pack')">
                        <div class="option-title">GT Pack</div>
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-back" onclick="nextStep(1)">Retour</button>
                <button class="btn" id="trimContinue" onclick="nextStep(3)" disabled>Continuer</button>
            </div>
        </div>

        <!-- Step 3: Contact Information -->
        <div class="step" id="step3">
            <h2 class="step-title">Vos informations</h2>
            <p class="step-subtitle">Pour finaliser votre évaluation personnalisée</p>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label" for="firstName">Prénom</label>
                    <input type="text" id="firstName" class="form-input" placeholder="Jean" />
                </div>
                <div class="form-group">
                    <label class="form-label" for="lastName">Nom</label>
                    <input type="text" id="lastName" class="form-input" placeholder="Dupont" />
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label" for="email">Email</label>
                    <input type="email" id="email" class="form-input" placeholder="jean.dupont@email.com" />
                </div>
                <div class="form-group">
                    <label class="form-label" for="phone">Téléphone</label>
                    <input type="tel" id="phone" class="form-input" placeholder="06 12 34 56 78" />
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Consentements</label>
                <div style="display: flex; flex-direction: column; gap: 16px;">
                    <label style="display: flex; align-items: flex-start; gap: 8px; font-weight: normal; cursor: pointer;">
                        <input type="checkbox" id="consent-data" style="margin-top: 2px; min-width: 16px;">
                        <span style="font-size: 14px;">Vos données personnelles seront traitées par SVO - SPOTICAR, situé au 2-10 Boulevard de l'Europe, 78300 Poissy, en tant que responsable de traitement, tel que décrit dans la <a href="#" style="color: #13d0ca; text-decoration: none;">Politique de Confidentialité</a>, où vous trouverez plus d'informations sur vos droits liés à la confidentialité et les moyens de nous contacter.</span>
                    </label>
                    
                    <div style="border-top: 1px solid #e9ecef; padding-top: 16px;">
                        <div style="font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; justify-content: space-between;">
                            <span>Rejoignez-nous !</span>
                            <span style="color: #13d0ca; font-size: 18px;">▲</span>
                        </div>
                        <div style="margin-bottom: 16px;">
                            <p style="font-size: 14px; color: #6c757d; margin-bottom: 12px; line-height: 1.4;">
                                Nous aimerions entretenir un lien privilégié avec vous et vous seul(e), et personnaliser l'expérience que nous allons partager ! Recevez des offres et des affaires personnalisées, des promotions, des invitations à des événements et d'autres contenus intéressants sur nos marques. Restons en contact ! Si vous voulez en savoir plus sur ce que nous ferons de vos données, consultez les sections 4.c et 4.f) de notre <a href="#" style="color: #13d0ca; text-decoration: none;">Politique de confidentialité</a>. Et ne vous inquiétez pas ! Vous pourrez changer d'avis à tout moment en cliquant sur https://preferences.stellantis.com ! Si vous souhaitez donner votre consentement à des fins explicites uniquement
                            </p>
                        </div>
                        <label style="display: flex; align-items: flex-start; gap: 8px; font-weight: normal; cursor: pointer; margin-bottom: 12px;">
                            <input type="checkbox" id="consent-marketing" style="margin-top: 2px; min-width: 16px;">
                            <span style="font-size: 14px;">Je suis d'accord</span>
                        </label>
                    </div>

                    <div style="border-top: 1px solid #e9ecef; padding-top: 16px;">
                        <div style="font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; justify-content: space-between;">
                            <span>Si vous souhaitez en savoir plus sur ce que nous ferons de vos données, veuillez consulter la section</span>
                            <span style="color: #13d0ca; font-size: 18px;">▼</span>
                        </div>
                    </div>

                    <div style="border-top: 1px solid #e9ecef; padding-top: 16px;">
                        <div style="font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; justify-content: space-between;">
                            <span>Rejoignez nos partenaires !</span>
                            <span style="color: #13d0ca; font-size: 18px;">▲</span>
                        </div>
                        <div style="margin-bottom: 16px;">
                            <p style="font-size: 14px; color: #6c757d; margin-bottom: 12px; line-height: 1.4;">
                                Nous formons une grande communauté et partageons des choses intéressantes ! Si vous souhaitez rencontrer nos fantastiques partenaires et leur permettre de vous contacter directement, inscrivez-vous ! Si vous voulez en savoir plus sur ce que nous ferons de vos données, consultez la section 4.h) de notre <a href="#" style="color: #13d0ca; text-decoration: none;">Politique de confidentialité</a>. Et ne vous inquiétez pas ! Vous pourrez changer d'avis à tout moment en cliquant sur https://preferences.stellantis.com !
                            </p>
                        </div>
                        <label style="display: flex; align-items: flex-start; gap: 8px; font-weight: normal; cursor: pointer; margin-bottom: 12px;">
                            <input type="checkbox" id="consent-partners" style="margin-top: 2px; min-width: 16px;">
                            <span style="font-size: 14px;">Je suis d'accord</span>
                        </label>
                        <label style="display: flex; align-items: flex-start; gap: 8px; font-weight: normal; cursor: pointer;">
                            <input type="checkbox" id="consent-no-partners" style="margin-top: 2px; min-width: 16px;">
                            <span style="font-size: 14px;">Je ne suis pas d'accord</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-back" onclick="nextStep(2)">Retour</button>
                <button class="btn" onclick="nextStep(4)">Obtenir mon estimation</button>
            </div>
        </div>

        <!-- Step 4: Confirmation -->
        <div class="step" id="step4">
            <h2 class="step-title">Votre estimation</h2>
            
            <p style="font-size: 14px; color: #6c757d; text-align: center; margin: 0 0 16px 0; border-bottom: 1px solid #f0f0f0; padding-bottom: 16px;" id="vehicleRecapFinal">
                Peugeot 308 Hybride • 2022 • 150 000 km • Finition Style
            </p>

            <div class="estimate-amount">15 750€ <sup style="font-size: 16px; color: #6c757d;">(1)</sup></div>

            <p style="font-size: 12px; color: #6c757d; text-align: center; margin: -16px 0 32px 0; line-height: 1.4;">
                (1) L'estimation peut être ajustée lors de votre rendez-vous en point de vente. Estimation valable jusqu'au 04/10/25.
            </p>

            <div class="calculation-breakdown">
                <h3 style="margin-bottom: 12px; font-size: 16px;">Comment avons-nous calculé ce prix ?</h3>
                <p style="color: #6c757d; font-size: 13px; line-height: 1.5; margin: 0;">
                    Notre estimation repose sur les caractéristiques de votre véhicule et sur l'analyse des tendances du marché. Elle inclut une déduction forfaitaire pour les frais de remise en état, ajustable en fonction de l'état réel de votre voiture.
                </p>
            </div>

            <div class="next-steps">
                <h3 style="margin-bottom: 12px; font-size: 16px;">Prochaines étapes</h3>
                <ul style="margin: 0; padding: 0; list-style: none;">
                    <li style="margin-bottom: 6px; padding-left: 20px; position: relative; font-size: 13px; line-height: 1.4;">
                        <span style="position: absolute; left: 0; color: #13d0ca; font-weight: bold;">✓</span>
                        Rendez-vous point de vente pour l'expertise complète de votre véhicule
                    </li>
                    <li style="margin-bottom: 0; padding-left: 20px; position: relative; font-size: 13px; line-height: 1.4;">
                        <span style="position: absolute; left: 0; color: #13d0ca; font-weight: bold;">✓</span>
                        Reprise de votre véhicule par Spoticar une fois l'expertise validée
                    </li>
                </ul>
            </div>

            <div class="button-group">
                <button class="btn btn-back" onclick="nextStep(3)">Modifier</button>
                <button class="btn" onclick="restart()">Nouvelle évaluation</button>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        let selectedTrim = '';
        let trimBonus = 0;
        let baseEstimate = 15000;

        function updateProgress() {
            const progress = (currentStep / 4) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = `Étape ${currentStep} sur 4`;
        }

        function nextStep(step) {
            // Hide current step
            document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
            
            // Show target step
            document.getElementById(`step${step}`).classList.add('active');
            currentStep = step;
            updateProgress();

            // Special actions for specific steps
            if (step === 2) {
                // Update vehicle info in step 2
                const mileage = document.getElementById('mileage').value;
                if (mileage) {
                    document.getElementById('vehicleMileage').textContent = mileage + ' km';
                }
            } else if (step === 4) {
                updateEstimate();
            }
        }

        function selectTrim(element, trim) {
            // Remove selection from all trim options
            document.querySelectorAll('.trim-option').forEach(el => el.classList.remove('selected'));
            
            // Select current trim
            element.classList.add('selected');
            selectedTrim = trim;
            
            // Set trim bonus
            const trimBonuses = {
                'style': 0,
                'allure': 750,
                'allure-pack': 1200,
                'gt': 1500,
                'gt-pack': 2000
            };
            trimBonus = trimBonuses[trim];
            
            // Enable continue button
            document.getElementById('trimContinue').disabled = false;
        }

        function updateEstimate() {
            const mileageDeduction = -1500; // Fixed for demo
            const finalTotal = baseEstimate + mileageDeduction + trimBonus;
            
            // Update the estimate amount (keeping the (1) reference)
            document.querySelector('.estimate-amount').innerHTML = `${finalTotal.toLocaleString()}€ <sup style="font-size: 16px; color: #6c757d;">(1)</sup>`;
            
            // Update vehicle recap with selected trim
            const mileage = document.getElementById('mileage').value || '150 000';
            const trimNames = {
                'style': 'Style',
                'allure': 'Allure',
                'allure-pack': 'Allure Pack',
                'gt': 'GT',
                'gt-pack': 'GT Pack'
            };
            const trimName = trimNames[selectedTrim] || 'Style';
            document.getElementById('vehicleRecapFinal').textContent = `Peugeot 308 Hybride • 2022 • ${mileage} km • Finition ${trimName}`;
        }

        function restart() {
            currentStep = 1;
            selectedTrim = '';
            trimBonus = 0;
            document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
            document.getElementById('step1').classList.add('active');
            document.querySelectorAll('input, select').forEach(el => el.value = '');
            document.querySelectorAll('.option-card').forEach(el => el.classList.remove('selected'));
            document.getElementById('trimContinue').disabled = true;
            updateProgress();
        }
    </script>
</body>
</html>
